<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema de Reportes de DaÃ±os</title>
    <link rel="stylesheet" href="../css/style-dahsboard.css" />
    <link rel="icon" href="../img/iconic-removebg-preview.png" type="image/x-icon">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
</head>

<body>
    <header class="panel-superior">
        <div class="header-content">
            <h1><i class="fas fa-exclamation-triangle"></i> SISTEMA DE REPORTES DE DAÃ‘OS</h1>
            <div class="user-controls">
                <span id="user-welcome" class="user-info">Bienvenido, <span id="user-name">Usuario</span></span>
                <button id="logout-btn" class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Cerrar SesiÃ³n
                </button>
            </div>
        </div>
    </header>

    <main>
        <div class="contenedor">
            <aside class="sidebar">
                <h2>BIENVENIDO <br><span>"EMPRESA"</span></h2>
                <div class="mapa" id="map">
                </div>
            </aside>

            <section class="contenido">
                <div class="tabla-contenedor">
                    <table id="createTable">
                        <!-- La tabla se genera por db-panel.js -->
                    </table>
                </div>
            </section>
        </div>
    </main>

    <footer class="footer">
        <span><i class="fas fa-copyright"></i> 2025 Sistema de Reportes de DaÃ±os - GestiÃ³n Municipal</span>
    </footer>

    <!-- Scripts en orden especÃ­fico -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    
    <!-- PROTECCIÃ“N DE RUTA - VerificaciÃ³n inmediata de autenticaciÃ³n -->
    <script>
        // VerificaciÃ³n inmediata de autenticaciÃ³n al cargar la pÃ¡gina
        (function() {
            const user = localStorage.getItem("user");
            const token = localStorage.getItem("authToken");
            
            // Si no hay datos de autenticaciÃ³n, redirigir inmediatamente
            if (!user || !token) {
                console.log("ðŸš« Acceso denegado: Redirigiendo a login...");
                window.location.href = './login.html';
                return;
            }
            
            // Verificar si la sesiÃ³n ha expirado (24 horas)
            try {
                const userData = JSON.parse(user);
                if (userData.loginTime) {
                    const loginTime = new Date(userData.loginTime);
                    const now = new Date();
                    const hoursDiff = (now - loginTime) / (1000 * 60 * 60);
                    
                    if (hoursDiff > 24) {
                        console.log("ðŸš« SesiÃ³n expirada: Redirigiendo a login...");
                        localStorage.removeItem("user");
                        localStorage.removeItem("authToken");
                        window.location.href = './login.html';
                        return;
                    }
                }
                
                console.log("âœ… Acceso autorizado al dashboard");
            } catch (error) {
                console.error("Error validando sesiÃ³n:", error);
                window.location.href = './login.html';
            }
        })();
    </script>
    <script type="module" src="../js/dashboard.js"></script>
    <script type="module" src="../js/db-panel.js"></script>
    <script type="module" src="../js/maps/mapa.js"></script>
</body>
</html>